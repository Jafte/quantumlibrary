{% extends "story/base.html" %}

{% load account humanize %}

{% block title %}{{ story.title }}{% endblock %}

{% block content %}
<div class="uk-grid uk-grid-small">
    <div class="uk-push-1-10 uk-width-9-10">
    <h1>{{ story.title }}</h1>
    {% if story.creator == user %}
    <div class="uk-text-mutted">
        <a href="{% url 'story_edit' story.pk %}" title="редактировать">
            <div class="uk-badge uk-badge-warning">
                <i class="uk-icon-pencil-square-o"></i>
                редактировать
            </div>
        </a>
    </div>
    {% endif %}
    </div>
    
    <div class="uk-width-1-1">
    {% spaceless %}
    {% for part in story_parts %}
        <div class="uk-grid uk-grid-small uk-margin-top" data-uk-grid-match>
            <div class="uk-width-1-10 uk-position-relative">
                <div class="uk-position-top-right">
                {% if part.parent %}
                <div class="uk-text-right">
                    <button class="uk-button uk-button-small">
                        <i class="uk-icon-thumbs-up"></i>
                        20
                    </button>
                </div>
                {% endif %}
                </div>
            </div>
            <div class="uk-width-medium-7-10 uk-width-small-9-10">
                {{ part.text_block.text }}
            </div>
            <div class="uk-width-medium-2-10 uk-width-small-1-1">
                <div class="uk-margin-bottom">
                    {% if part.is_root_node %}
                    <div class="uk-badge">
                        <i class="uk-icon-lock"></i>
                    </div>
                    {% endif %}
                    {% if part.is_child_node %}
                    <a 
                        class="uk-button uk-button-mini uk-button-danger"
                        href="{% url 'story_part_create_variant' story.pk part.pk %}"
                        title="предложить свою версию" 
                    >
                        <i class="uk-icon-code-fork"></i>
                    </a>
                    {% endif %}
                    {% if part.get_siblings %}
                    <a 
                        class="modal-story-variants-show uk-button uk-button-mini uk-button-warning" 
                        href="{% url 'story_detail_part_variants' story.pk part.pk %}" 
                        data-uk-modal='{"target":"#modal-story-variants"}'
                        title="алтернативные варианты" 
                    >
                        <i class="uk-icon-sitemap"></i>
                        {{ part.get_siblings.count }}
                    </a>
                    {% endif %}
                </div>
                <div class="uk-text-muted uk-text-small">
                    написал {% if part.text_block.author %}{{ part.text_block.author }}{% else %}аноним{% endif %}<br/>
                    {{ part.text_block.created|naturaltime }}
                </div>
            </div>
        </div>
        {% empty %}
            <p class="uk-panel-title">Тлен и пустота в твоей истории :(</p>
        {% endfor %}
        <div class="uk-grid">
            <div class="uk-push-1-10 uk-width-7-10">
                <div class="uk-grid">
                    <div class="uk-width-3-5 uk-text-center">
                        <a class="uk-button uk-width-1-1" href="{% url 'story_part_create_next' story.pk primary_story_line.pk %}">
                            написать новуя часть
                        </a>
                    </div>
                    <div class="uk-width-2-5 uk-text-center">
                        <button class="uk-button uk-button-primary uk-width-1-1">
                            закончить историю
                        </button>
                    </div>
                </div>
            </div>
        </div>
    {% endspaceless %}
    </div>
</div>
{% endblock %}

{% block right_line %}{% spaceless %}

{% endspaceless %}{% endblock %}
