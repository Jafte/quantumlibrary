{% extends "story/base.html" %}

{% load account %}

{% block title %}{{ story.title }}{% endblock %}

{% block breadcrumbs %}
    {{block.super}}
    <i class="right chevron icon divider"></i>
    <a href="{% url 'story_list' %}" class="section">Истории</a>
{% endblock %}

{% block breadcrumbs_active %}
    <i class="right chevron icon divider"></i>
    <div class="active section">{{ story.title }}</div>
{% endblock %}

{% block content %}
    <h1>{{ story.title }}</h1>
    {% for part in story_parts %}
        <div class="ui vertical segment" id="part-{{ part.pk }}" >
            <div class="content margin-bottom">
                {{ part.text }}
            </div>
            {% if part.is_child_node %}
            <a href="{% url 'story_part_create' story.pk part.parent.pk %}" class="ui tiny icon basic green button">
                <i class="plus icon"></i>
                добавить алтернативный вариант
            </a>
            <div class="ui circular icon red basic tiny button show-parts-{{ part.pk }} right floated ">
                <i class="sitemap icon"></i>
                дерево алтернативных вариантов
            </div>
            {% endif %}
        </div>
        {% if part.is_child_node %}
            <div class="ui modal parts-{{ part.pk }}">
                <i class="close icon"></i>
                <div class="content">
                    {% for p in part.get_siblings %}
                        <div class="ui vertical segment">
                            <a class="meta" href="{{ p.get_absolute_url }}">
                                #{{ p.id }} от {{ p.created }}
                            </a>
                            <div>
                                {{ p.text }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    {% empty %}
    <div class="ui vertical segment">
        Тлен и пустота в твоей истории :(
    </div>
    {% endfor %}
    <div class="ui vertical segment">
        <a class="ui fluid basic olive button" href="{% url 'story_part_create' story.pk primary_story_line.pk %}">
            продолжить историю
        </a>
    </div>
{% endblock %}


{% block javascript %}
    {% for part in story_parts %}
        {% if part.is_child_node %}
            $('.parts-{{ part.pk }}.modal')
                .modal('attach events', '.show-parts-{{ part.pk }}', 'show')
            ;
        {% endif %}
    {% endfor %}
{% endblock %}