{% extends "story/base.html" %}

{% load account %}

{% block title %}{{ story.title }}{% endblock %}

{% block breadcrumbs %}
    {{block.super}}
    <i class="right chevron icon divider"></i>
    <a href="{% url 'story_list' %}" class="section">Истории</a>
{% endblock %}

{% block breadcrumbs_active %}
    <i class="right chevron icon divider"></i>
    <div class="active section">{{ story.title }}</div>
{% endblock %}

{% block content %}
    <h1>{{ story.title }}</h1>
    <div class="ui one column grid">
        {% for part in story_parts %}
            <div id="part-{{ part.pk }}" class="column">
                {% if part.is_child_node %}
                    <a class="ui tiny bottom left attached label" href="{% url 'story_part_create' story.pk part.parent.pk %}" >
                        предложить версию
                    </a>
                    <a
                        class="ui floating teal label show-popup show-parts-{{ part.pk }}"
                        data-content="алтернативных вариантов"
                    >
                        {{ part.get_siblings|length }}
                    </a>
                {% endif %}
                <div class="content">
                    {{ part.text }}
                </div>
            </div>
            {% if part.is_child_node and part.get_siblings %}
                <div class="ui modal parts-{{ part.pk }}">
                    <i class="close icon"></i>
                    <div class="content">
                        {% for p in part.get_siblings %}
                            <div class="ui vertical segment">
                                <a class="meta" href="{{ p.get_absolute_url }}">
                                    #{{ p.id }} от {{ p.created }}
                                </a>
                                <div>
                                    {{ p.text }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% empty %}
        <div class="ui segment">
            Тлен и пустота в твоей истории :(
        </div>
        {% endfor %}
        <div class="column">
            <a class="ui fluid basic olive button" href="{% url 'story_part_create' story.pk primary_story_line.pk %}">
                продолжить историю
            </a>
        </div>
    </div>
{% endblock %}


{% block javascript %}
    {% for part in story_parts %}
        {% if part.is_child_node %}
            {% if part.get_siblings %}
                $('.parts-{{ part.pk }}.modal')
                    .modal('attach events', '.show-parts-{{ part.pk }}', 'show')
                ;
            {% endif %}
        {% endif %}
    {% endfor %}
{% endblock %}